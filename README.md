# Website hestialabs.org

[![Netlify Status](https://api.netlify.com/api/v1/badges/de7a1d71-9b54-4c6c-b2f6-1fa6341804af/deploy-status)](https://app.netlify.com/sites/hestialabs/deploys)

Our HestiaLabs main website:

* [`hestialabs.netlify.app/{fr,en}`](https://hestialabs.netlify.app/en/) ⟵ is currently accessible here;
* [`hestialabs.org/{fr,en}`](https://hestialabs.org/en/) ⟵ will be accessible here on public launch.

# Deliverables

The website is currently made of two major deliverables; whose sources are available in this repository:

1. [`hestialabs.netlify.app`](https://hestialabs.netlify.app): publicly accessible website of HestiaLabs, in french and english;
2. [`hestialabs.netlify.app/admin`](https://hestialabs.netlify.app/admin/): our [content-authoring system (_aka_ NetlifyCMS)](https://www.netlifycms.org), accessible thru invite only.

# TODO

- structured multilingual page using several yaml variables
- single_file, about pops up in the cms under multiple folder i18n. remove it, only use multiple_file -> no file only folder collections
- tags for blog posts
- links between blog posts
- Snowpack and web components

# Access rights

## NetlifyCMS

Would you need _editorial access_ to the website contents — that is, to our NetlifyCMS content-authoring & management system:

* ask [@olange](https://github.com/olange) or [@andreaskundig](https://github.com/andreaskundig) for an invite to the HestiaLabs site;
* access is defined from [Netlify › Hestia _team_ › HestiaLabs _site_ › Identity](https://app.netlify.com/sites/hestialabs/identity) webpage.

## Netlify

Would you need to _administer_ our Netlify deployment & hosting infrastructure:

* ask [@olange](https://github.com/olange) or [@andreaskundig](https://github.com/andreaskundig) to share access with you to the [Netlify › Hestia Team](https://app.netlify.com/teams/hestia/overview) account;
* we sign-in with a single shared `service-owners+netlify` Netlify account (2FA-enabled), to run our hosting with [Netlify's Starter Free Plan](https://www.netlify.com/pricing).

# Repository contents

## Overview & repository structure

```ascii
/ ....................... NPM, 11ty & Netlify scripts for assembly, publishing & deployment
|
+-- conf/ ............... Config of our publish & deploy pipeline
|   +-- 11ty/ ........... Eleventy config files included from .eleventy.js
|   +-- netlifycms/ ..... NetlifyCMS config file, deployed to admin/ upon build
|
+-- src/ ................ Sources (en/fr) of the components used to generate the website
|   +-- components/ ..... Web Components (front-end) used in layouts
|   +-- site/ ........... Actual contents of website, along with layouts and assets
|       +-- _data/ ...... Fragments of data consumed by 11ty to generate static pages
|       +-- _includes/ .. Layouts and includes consumed by 11ty to generate static pages
|       +-- static/ ..... Media assets, such as stylesheets and images
|       +-- admin/ ...... NetlifyCMS single-page app, to edit contents online
|       +-- home/ ....... Main homepage
|       +-- about/ ...... About us page
|       +-- blog/ ....... Blog homepage
|       +-- post/ ....... Blog articles
|       +-- tag/ ........ Tags of blog articles
|
+-- build/ .............. (transient) Generated website, in its various stages
    +-- 11ty/ ........... (transient) Generated by 11ty, picked up by Snowpack
    +-- snowpack/ ....... (transient) Generated by Snowpack and deployed by Netlify
```

## Essential configuration files

```ascii
/ 
|
+-- netlify.toml ......... Netlify CB/CD and hosting config, which includes definition of
|                          runtime URL redirects, role-based access restrictions and HTTP-header overrides
+-- .eleventy.js ......... In-/out folders and config of 11ty build process
+-- .snowpack.config.js .. In-/out folders and config of Snowpack dev & build processes
|
+-- conf/netlifycms/
    +-- config.yml ....... NetlifyCMS runtime config
```

# Execution

## Modes & environments

* **Development build, serve & watch cycle** in dev environment — triggered by `npm run start`

  11ty and Snowpack dev builds, Snowpack watch & serve with HMR, executed in _developer environment_, upon their request; optionally complemented with NetlifyCMS-proxy, a component allowing direct update of the contents of local Git repository, thru the NetlifyCMS single-page-app;

* **Production build** in either developer, or Netlify CB/CD environments — triggered by `npm run build`, or `git push`

  11ty & Snowpack static builds, executed in either _developer environment_, upon their request; or _Netlify continuous build/deployment (CB/CD) environment_, automatically, upon push in GitHub repository;

* **App runtime** in end-user browser environment — accessed by visiting `hestialabs.org`

  static content delivered to end-users by Netlify's CDN and executed in their _browser environment_; upon authentication, end-users can optionally access the content-authoring/management webapp.

## Sequences

### Build, serve & watch sequence · Snowpack and 11ty

3. First come the _build sequence_ described [hereafter](#build-sequence--snowpack-and-11ty);
4. Both 11ty and Snowpack watch for subsequent changes:
5. … 11ty watches for changes in `src` subfolders and produces the static website again in `build/11ty`, as described hereafter
6. … Snowpack watches for changes in `build/11ty`, as well as in the source folders for ES modules and Web Components to rebuild, and any one change will produce a new Snowpack build, as described hereafter.

### Build sequence · Snowpack and 11ty

1. First comes 11ty, which reads its config from `.eleventy.js`
2. … reads source contents from `src` subfolders
3. … and produces a static website in the `build/11ty` folder.
4. Then comes Snowpack, which reads contents from `build/11ty` folder
5. … and source code of our runtime dependencies from `node_modules` subfolders.
6. And Snowpack produces …
7. … a copy of the website generated by 11ty in same `build/snowpack` folder
8. … along with independently bundled ES modules in `build/snowpack/modules`
9. … and Web Components in `build/snowpack/components`.

### Deployment sequence · GitHub and Netlify

1. Netlify picks up any change pushed to this GitHub repository
2. … then triggers the above build sequence in its CB environment
3. … and, if the build was successful, deploys the result to its CDN & hosting infrastructure
4. … along with the URL redirect rules, HTTP-header overrides and role-based access restrictions defined in the `netlify.toml` config file.

# Contributing

## Design decisions you should know about

`TODO`

Most of our setup follows Snowpack, 11ty & NetlifyCMS standards. Combining
those tools, and satisfying our i18n requirements, however required a few 
_not-so-obvious_ and sometimes _complected_ design decisions, which should
be described hereafter.

### Structural & functional constraints

* Website URL space
* NetlifyCMS i18n support
* Source repository